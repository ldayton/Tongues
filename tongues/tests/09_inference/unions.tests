=== union with isinstance discrimination allowed
def f(x: int | str) -> str:
    if isinstance(x, int):
        return str(x)
    return x
---
ok
---

=== union with isinstance else branch allowed
def f(x: int | str) -> int:
    if isinstance(x, str):
        return len(x)
    return x
---
ok
---

=== three-way union isinstance allowed
def f(x: int | str | float) -> str:
    if isinstance(x, int):
        return "int"
    if isinstance(x, str):
        return "str"
    return "float"
---
ok
---

=== union with kind field discrimination allowed
from dataclasses import dataclass
@dataclass
class Add:
    kind: str
    left: int
    right: int
@dataclass
class Sub:
    kind: str
    left: int
    right: int
def eval(node: Add | Sub) -> int:
    if node.kind == "add":
        return node.left + node.right
    return node.left - node.right
---
ok
---

=== union kind with elif allowed
from dataclasses import dataclass
@dataclass
class Add:
    kind: str
    left: int
    right: int
@dataclass
class Sub:
    kind: str
    left: int
    right: int
@dataclass
class Mul:
    kind: str
    left: int
    right: int
def eval(node: Add | Sub | Mul) -> int:
    if node.kind == "add":
        return node.left + node.right
    elif node.kind == "sub":
        return node.left - node.right
    else:
        return node.left * node.right
---
ok
---

=== union with match statement allowed
def f(x: int | str) -> str:
    match x:
        case int():
            return str(x)
        case str():
            return x
---
ok
---

=== optional union access after none check allowed
def f(x: int | str | None) -> str:
    if x is None:
        return "none"
    if isinstance(x, int):
        return str(x)
    return x
---
ok
---

=== union return type allowed
def f(flag: bool) -> int | str:
    if flag:
        return 1
    return "hello"
---
ok
---

=== union in list allowed
def f() -> list[int | str]:
    return [1, "hello", 2, "world"]
---
ok
---

=== union parameter allowed
def f(x: int | str) -> int:
    if isinstance(x, int):
        return x
    return len(x)
---
ok
---

=== union field allowed
from dataclasses import dataclass
@dataclass
class Container:
    value: int | str
def f(c: Container) -> int:
    if isinstance(c.value, int):
        return c.value
    return len(c.value)
---
ok
---

=== common method on union allowed
def f(x: list[int] | tuple[int, ...]) -> int:
    return len(x)
---
ok
---

=== undiscriminated union member access not allowed
def f(x: int | str) -> int:
    return x + 1
---
error: union
---

=== undiscriminated union method call not allowed
def f(x: int | str) -> str:
    return x.upper()
---
error: union
---

=== wrong isinstance branch not allowed
def f(x: int | str) -> int:
    if isinstance(x, int):
        return len(x)
    return 0
---
error: len
---

=== union without common attribute not allowed
from dataclasses import dataclass
@dataclass
class Foo:
    x: int
@dataclass
class Bar:
    y: str
def f(v: Foo | Bar) -> int:
    return v.x
---
error: attribute
---

=== kind check with wrong value not allowed
from dataclasses import dataclass
@dataclass
class Add:
    kind: str
    left: int
    right: int
@dataclass
class Sub:
    kind: str
    left: int
    right: int
def f(node: Add | Sub) -> int:
    if node.kind == "mul":
        return node.left * node.right
    return 0
---
error: kind
---

=== union assignment allowed
def f(flag: bool) -> int | str:
    x: int | str = 1
    if flag:
        x = "hello"
    return x
---
ok
---

=== narrowed union can access specific method
def f(x: int | str) -> str:
    if isinstance(x, str):
        return x.upper()
    return str(x)
---
ok
---

=== union with none requires discrimination
def f(x: int | str | None) -> int:
    return x + 1
---
error: None
---

=== exhaustive isinstance chain allowed
def f(x: int | str | bool) -> str:
    if isinstance(x, int):
        return "int"
    if isinstance(x, str):
        return "str"
    return "bool"
---
ok
---

=== nested union discrimination allowed
def f(x: int | str | None) -> str:
    if x is None:
        return "none"
    if isinstance(x, int):
        return str(x)
    return x
---
ok
---
